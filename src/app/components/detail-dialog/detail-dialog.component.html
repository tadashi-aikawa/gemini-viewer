<div style="display: flex;">
    <ng-select #selector
               [options]="options"
               [(ngModel)]="activeIndex"
               [ngStyle]="{
                'z-index': '99',
                'font-size': '1.2rem'
            }"
               [className]="'smart-padding-without-left'"
               (selected)="showTrial(getActiveTrial())"
    >
    </ng-select>
    <div>
        <a href={{createActiveTrialLink()}}><md-icon class="action-icon hvr-buzz-out">link</md-icon></a>
    </div>
</div>
<md-tab-group  [selectedIndex]="activeTabIndex" (selectedIndexChange)="afterChangeTab($event)">
    <md-tab label="Diff viewer">
        <div class="smart-padding-small" style="display: flex; justify-content: space-around">
            <div>
                <md-chip>{{oneAccessPoint.name}}</md-chip>
                <small>
                    <a [href]="getActiveTrial().one.url" class="ellipsis-text" style="width: 30vw" target="_blank">
                        {{oneAccessPoint.host}}.....
                    </a>
                </small>
            </div>
            <div>
                <md-chip>{{otherAccessPoint.name}}</md-chip>
                <small>
                    <a [href]="getActiveTrial().other.url" class="ellipsis-text" style="width: 30vw" target="_blank">
                        {{otherAccessPoint.host}}.....
                    </a>
                </small>
            </div>
        </div>
        <div *ngIf="isLoading" class="center" style="height: 50vh;">
            <md-spinner style="width: 50vh; height: 50vh;"></md-spinner>
        </div>
        <div *ngIf="!isLoading && !errorMessage">
            <app-merge-viewer #mergeView
                              [config]="mergeViewConfig"
                              (onKeyD)="changeTab(0)"
                              (onKeyQ)="changeTab(1)"
                              (onKeyP)="changeTab(2)"
                              (onKeyI)="mergeView.moveToPreviousDiff($event)"
                              (onKeyJ)="showPreviousTrial()"
                              (onKeyK)="mergeView.moveToNextDiff($event)"
                              (onKeyL)="showNextTrial()"
                              (onKeyW)="closeDialog()"
                              (onKeySlash)="openSelector()"
                              (onKeyQuestion)="toggleCheatSheet()"
            >
            </app-merge-viewer>
            <div class="smart-padding-small" style="display: flex; justify-content: space-around">
                <small>{{oneExpectedEncoding}}</small>
                <small>{{otherExpectedEncoding}}</small>
            </div>
        </div>
        <div *ngIf="errorMessage">
            {{errorMessage}}
        </div>
    </md-tab>
    <md-tab label="Query parameters">
        <div class="shape-margin">
            <ng2-smart-table [settings]="queryTableSettings"
                             [source]="queryTableSource"
            >
            </ng2-smart-table>
        </div>
    </md-tab>
    <md-tab label="Property diffs">
        <div style="display: flex; justify-content: space-between;">
            <div style="width: 50%">
                <h2 class="center-vertical">
                    <md-icon>report_problem</md-icon>&nbsp;Unknown!!
                </h2>
                <table>
                    <tr *ngFor="let p of findUnknownPropertyDiffs()" class="centering-vertical">
                        <td class={{p.type}}>
                            <md-icon>{{p.type === 'added' ? 'add' : p.type === 'removed' ? 'remove' : 'autorenew'}}
                            </md-icon>
                        </td>
                        <td class="property-diffs">{{p.pattern}}</td>
                    </tr>
                </table>
                <h2 class="center-vertical">
                    <md-icon>thumb_up</md-icon>&nbsp;Checked already
                </h2>
                <table>
                    <tr *ngFor="let p of findCheckedAlreadyPropertyDiffs()" class="centering-vertical">
                        <td class={{p.type}}>
                            <md-icon>{{p.type === 'added' ? 'add' : p.type === 'removed' ? 'remove' : 'autorenew'}}
                            </md-icon>
                        </td>
                        <td class="property-diffs">{{p.pattern}}</td>
                        <td class="comment" [innerHTML]="p.note"></td>
                    </tr>
                </table>
                <h2 class="center-vertical">
                    <md-icon>visibility_off</md-icon>&nbsp;Ignored
                </h2>
                <table>
                    <tr *ngFor="let p of findIgnoredPropertyDiffs()" class="centering-vertical">
                        <td class={{p.type}}>
                            <md-icon>{{p.type === 'added' ? 'add' : p.type === 'removed' ? 'remove' : 'autorenew'}}
                            </md-icon>
                        </td>
                        <td class="property-diffs">{{p.pattern}}</td>
                        <td class="comment" [innerHTML]="p.note"></td>
                    </tr>
                </table>
            </div>
            <div style="max-width: 50%">
                <button md-button (click)="updateEditorConfig()">Save</button>
                <app-editor #editor
                            [config]="editorConfig">
                </app-editor>
            </div>
        </div>
    </md-tab>
</md-tab-group>
<hotkeys-cheatsheet></hotkeys-cheatsheet>
